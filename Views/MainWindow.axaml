<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:InventorySystem2.ViewModels"
        x:Class="InventorySystem2.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Width="1000" Height="650"
        Title="Inventory System (Basic)">

  <!-- 
    Hovedvindue (MVVM). Vi har: Process, Check DB, Reset DB, Ping/Connect,
    to DataGrids for queued/processed samt en statuslinje.
  -->

  <Grid Margin="16"
        RowDefinitions="Auto,Auto,Auto,*,Auto"
        ColumnDefinitions="*,*">

    <!-- Header -->
    <TextBlock Grid.ColumnSpan="2"
               FontSize="20" FontWeight="SemiBold"
               Text="Inventory System â€” basic DB view" />

    <!-- Controls row -->
    <StackPanel Grid.Row="1" Grid.ColumnSpan="2"
                Orientation="Horizontal" Spacing="12" Margin="0,8,0,8">
        
        <!-- Robot: IP + Connect (Ping) -->
      <TextBlock VerticalAlignment="Center" Text="Robot IP:"/>
      <TextBox Width="180"
               Watermark="localhost"
               Text="{Binding RobotIp}" />
      <Button Content="Connect" MinWidth="100"
              Command="{Binding PingCommand}" />

      <!-- Process -->
      <Button Content="Process next order"
              Command="{Binding ProcessNextCommand}" />

      <!-- Revenue -->
      <TextBlock VerticalAlignment="Center" Text="Total revenue:"/>
      <TextBlock VerticalAlignment="Center" FontWeight="Bold"
                 Text="{Binding TotalRevenue, StringFormat={}{0:C}}" />

      <!-- Check/Reset DB -->
      <Button Content="Check DB" MinWidth="110"
              Command="{Binding CheckDbCommand}" />
      <Button Content="Reset DB" MinWidth="110"
              Command="{Binding ResetDbCommand}" />
    </StackPanel>
    <!-- Create Order -->
    <Border Grid.Row="2" Grid.ColumnSpan="2"
            BorderThickness="1" CornerRadius="8"
            Padding="12" Margin="0,0,0,12">
        <StackPanel Spacing="8">
            <TextBlock Text="Opret ordre" FontWeight="SemiBold" />

            <!-- Inputs -->
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock VerticalAlignment="Center" Text="Produkt:"/>
                <ComboBox Width="220"
                          ItemsSource="{Binding AvailableItemIds}"
                          SelectedItem="{Binding SelectedItemId}" />

                <TextBlock VerticalAlignment="Center" Text="Antal:"/>
                <TextBox Width="80"
                         Watermark="1"
                         Text="{Binding NewQuantityText}" />

                <Button Content="Add line"
                        Command="{Binding AddOrderLineCommand}" />

                <Button Content="Submit order"
                        Command="{Binding SubmitOrderCommand}"
                        MinWidth="120"/>
            </StackPanel>

            <!-- Draft lines -->
            <ItemsControl ItemsSource="{Binding DraftOrderLines}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:DraftOrderLine">
                        <Border Padding="8" CornerRadius="6" BorderThickness="1" Margin="0,4,0,0">
                            <DockPanel>
                                <Button DockPanel.Dock="Right"
                                        Content="Remove"
                                        Command="{Binding $parent[Window].DataContext.RemoveOrderLineCommand}"
                                        CommandParameter="{Binding}" />

                                <TextBlock Text="{Binding Display}" />
                            </DockPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </Border>

    <!-- Queued Orders -->
    <StackPanel Grid.Row="3" Grid.Column="0">
      <TextBlock Text="Queued orders"
                 FontWeight="SemiBold"
                 Margin="0,0,0,4"/>
      <DataGrid ItemsSource="{Binding QueuedOrders}"
                AutoGenerateColumns="False"
                GridLinesVisibility="All"
                IsReadOnly="True"
                Height="260">
        <DataGrid.Columns>
          <DataGridTextColumn Header="Time"  Binding="{Binding Time}" />
          <DataGridTextColumn Header="Lines" Binding="{Binding LinesSummary}" />
          <DataGridTextColumn Header="Total" Binding="{Binding Total, StringFormat={}{0:C}}" />
        </DataGrid.Columns>
      </DataGrid>
    </StackPanel>

    <!-- Processed Orders -->
    <StackPanel Grid.Row="3" Grid.Column="1">
      <TextBlock Text="Processed orders"
                 FontWeight="SemiBold"
                 Margin="0,0,0,4"/>
      <DataGrid ItemsSource="{Binding ProcessedOrders}"
                AutoGenerateColumns="False"
                GridLinesVisibility="All"
                IsReadOnly="True"
                Height="260">
        <DataGrid.Columns>
          <DataGridTextColumn Header="Time"  Binding="{Binding Time}" />
          <DataGridTextColumn Header="Lines" Binding="{Binding LinesSummary}" />
          <DataGridTextColumn Header="Total" Binding="{Binding Total, StringFormat={}{0:C}}" />
        </DataGrid.Columns>
      </DataGrid>
    </StackPanel>

    <!-- Footer: statuslinje -->
    <DockPanel Grid.Row="4" Grid.ColumnSpan="2" Margin="0,8,0,0">
        <StackPanel DockPanel.Dock="Right"
                    Orientation="Horizontal"
                    Spacing="8">
            <Button Content="Create user"
                    IsVisible="{Binding IsAdmin}"
                    MinWidth="120"
                    Click="CreateUser_Click"/>

            <Button Content="Logout"
                    MinWidth="110"
                    Click="Logout_Click"/>
        </StackPanel>
        <TextBlock DockPanel.Dock="Left"
                   Text="Status:" FontWeight="SemiBold" Margin="0,0,8,0"/>
      <TextBlock DockPanel.Dock="Left"
                 Text="{Binding StatusMessage}" />
    </DockPanel>
  </Grid>
</Window>
